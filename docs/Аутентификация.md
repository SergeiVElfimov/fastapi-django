Для аутентификации 

# TODO

1. Мультибекендная аутентификация???

# Кейсы

1. Аутентификация в Кeycloak. Токен проверяется и на этом все.  Этот кейс можно заносить в библиотеку.
2. Аутентицикация в сервисе пользователей как в КЗ. Тут помимо валидации токена пользователь еще проверяется в БД. 
Это специфичный для проекта кейс. Он должен быть реализован в библиотеке проекта КЗ (partners-utils).
3. Базовая аутентификация в сервисе. Напр., аутентификация сервисного пользователя. Креды могут быть храниться 
как в памяти, так и в БД. Это тоже можно вынести в эту библиотеку. 
4. Различные token-based аутентификации, как напр. https://django-rest-framework-simplejwt.readthedocs.io
5. Аутентификация по сессии.

# Кастомная аутентификация

Чтобы написать кастомную аутентификацию, необходимо отнаследоваться от класса SecurityBase и определить атрибуты 

```python
from fastapi.security.base import SecurityBase
from fastapi.openapi.models import HTTPBearer


class CustomAuth(SecurityBase):
    def __init__(self):
        self.model = HTTPBearer(description="Кастомная аутентификация")
        self.scheme_name = self.__class__.__name__
```

# Аутентификация в сервисе User Administration (для КЗ)

Это пример кастомной аутентификации, которая не предполагается, что будет в библиотеке, и которой место в 
[библиотеке специфичной для КЗ](Специфичная%20для%20проекта%20библиотека.md), скажем, partner-utils.

Реализация [по ссылке](../fastapi_django/auth/some_kz_lib/usr_adm.py). Пример использования:

- в виде типа:

```python

from fastapi import APIRouter
from fastapi_django.auth.some_kz_lib.dependencies import AdmUsr

router = APIRouter()


@router.get("/users")
async def get_users(user: AdmUsr):
    print(user)
```

- в виде зависимости:

```python

from fastapi import APIRouter, Depends
from fastapi_django.auth.some_kz_lib.usr_adm import UsrAdmAuth

router = APIRouter()


@router.get("/users", dependencies=[Depends(UsrAdmAuth())])
async def get_users():
    pass
```

Для работы классу UsrAdmAuth необходимые (свои собственные) настройки:

- USR_ADM_AUTH_HOST -хост сервиса User Administration
- USR_ADM_AUTH_USERNAME - логин пользователя, от имени которого происходят запросы к сервису User Administration
- USR_ADM_AUTH_PASSWORD - пароль пользователя, от имени которого происходят запросы к сервису User Administration
- USR_ADM_AUTH_VERIFY - инструкция проверять или нет SSL-сертификаты
- USR_ADM_AUTH_REALM_URL - урл Keycloak, по которому можно найти публичный ключ
