# Отправка электронных писем

Реализована поддержка отправки электронных писем через множество провайдеров (которая заедет в Django 6, 
см. PR https://github.com/django/django/pull/18421/)

Во многом все как в Django. Много скопированого кода.

## Настройки

Настройки провайдеров хранятся в настройке `EMAIL_PROVIDERS`:

```python
EMAIL_PROVIDERS = {
    'console': {
        'BACKEND': 'fastapi_django.mail.backends.console.EmailBackend',
    },
    'dummy': {
        'BACKEND': 'fastapi_django.mail.backends.dummy.EmailBackend',
    },
    'filebased': {
        'BACKEND': 'fastapi_django.mail.backends.filebased.EmailBackend',
        "OPTIONS": {
            "file_path": "mails",
        }
    },
    'locmem': {
        'BACKEND': 'fastapi_django.mail.backends.locmem.EmailBackend',
    },
    'smtpsrv': {
        'BACKEND': 'fastapi_django.mail.backends.smtp.EmailBackend',
        "HOST": env.str("SMTPSRV_HOST"),
        "PORT": env.str("SMTPSRV_PORT"),
        "OPTIONS": {
            "username": env.str("SMTPSRV_USERNAME"),
            "password": env.str("SMTPSRV_PASSWORD"),
            "from_email": env.str("SMTPSRV_FROM_EMAIL"),
        },
    },
}
```

## Отправка электронных писем

Для отправки элеектронных писем реализована функция `fastapi_django.mail.send_mail`. Чтобы отправить письмо через 
конкретный провайдер, необходимо передать его алиас в параметр `provider`:

```python
from fastapi_django.mail import send_mail
await send_mail(
    subject="Тема письма", 
    body="Тело письма", 
    recipient_list=["recipient1@mail.ru"], 
    provider="smtpsrv"
)
```

## Реализации в сторонних библиотеках

Чтобы написать свой бэкенд, необходимо отнаследоваться от базового класса `fastapi_django.mail.backends.base.BaseEmailBackend` 
и реализовать необходимые методы.

### Нестандартные способы отправки писем

См. библиотеки fastapi-django-kz и fastapi-django-nkz.

## TODO

1. Фикстуры для работы с почтой https://pytest-django.readthedocs.io/en/stable/helpers.html#clearing-of-mail-outbox
2. Показалась интересной библиотека, которая реализует бекенд, который отправляет письмо в рамках серели таски https://pypi.org/project/django-celery-email/

## Ссылки

1. Поддержка множества бекендов отправки почты в Django https://code.djangoproject.com/ticket/35514#ticket, PR https://github.com/django/django/pull/18421
2. https://pypi.org/project/django-celery-email/
3. https://github.com/django-ses/django-ses/tree/main
4. 